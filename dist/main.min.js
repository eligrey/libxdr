/*! @source https://github.com/Financial-Times/ft-xdr/blob/master/src/libxdr.js*/
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){if(!window.XDR){window.XDR=function(){};XDR.prototype={open:function(method,uri,async){if(async===false)throw new RangeError("XDR.open: libxdr does not support synchronous requests.");this._request={method:method,uri:uri,headers:{}}},setRequestHeader:function(header,value){this._request.headers[header.toLowerCase()]=value},removeRequestHeader:function(header){delete this._request.headers[header.toLowerCase()]},send:function(data){var instance=this;instance._request.data=data;instance._request.callback=function(response){instance.readyState=4;if(response.error){if(response.error=="LOAD_ERROR"){instance.status=502;instance.statusText="Bad Gateway"}else if(response.error=="DISALLOWED_REQUEST_METHOD"){instance.status=405;instance.statusText="Method Not Allowed"}else if(response.error=="TIMEOUT"){instance.status=408;instance.statusText="Request Timeout"}else if(response.error=="DISALLOWED_ORIGIN"){instance.status=412;instance.statusText="Precondition Failed"}}else{if(response.status)instance.status=response.status;if(response.statusText)instance.statusText=response.statusText}if(!instance.status)instance.status=200;if(response.error||instance.status>=400){if(typeof instance.onloadend=="function")instance.onloadend();if(typeof instance.onerror=="function")return instance.onerror()}if(instance.status==408&&typeof instance.ontimeout=="function")return instance.ontimeout();if(!response.headers){response.headers={}}instance.contentType=response.headers["content-type"];var headers=[];for(var header in response.headers)if(response.headers.hasOwnProperty(header))headers.push(header+": "+response.headers[header]);headers=headers.join("\r\n");instance.getAllResponseHeaders=function(){return headers};instance.getResponseHeader=function(header){return response.headers[header.toLowerCase()]||null};var xml;if(/\/xml$/i.test(instance.contentType)||response.data.substr(0,5)=="<?xml"){try{if(window.DOMParser){xml=(new DOMParser).parseFromString(response.data,"text/xml")}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data)}}catch(e){xml=undefined}if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){xml=undefined}}instance.responseXML=xml;instance.responseText=response.data;if(typeof instance.onreadystatechange=="function")instance.onreadystatechange();if(typeof instance.onprogress=="function")instance.onprogress();if(typeof instance.onload=="function")instance.onload();if(typeof instance.onloadend=="function")instance.onloadend()};if(instance.timeout)instance._request.timeout=instance.timeout;else if(XDR.defaultTimeout)instance._request.timeout=XDR.defaultTimeout;var aborter=pmxdr.request(instance._request).abort;instance.abort=function(){aborter()}},abort:function(){delete this._request}}}},{}],2:[function(require,module,exports){"use strict";require("./pmxdr-host");require("./pmxdr-client");window.XMLHttpRequest=require("./libxdr");typeof ftXDRLoaded==="function"&&ftXDRLoaded()},{"./libxdr":1,"./pmxdr-client":3,"./pmxdr-host":4}],3:[function(require,module,exports){(function(window){if(typeof window.opera!="undefined"&&parseInt(window.opera.version())==9)Event.prototype.__defineGetter__("origin",function(){return"http://"+this.domain});function pmxdr(host,onload){var instance=this;instance.iFrame=document.createElement("iframe");instance.iFrame.style.display="none";instance.origin=host.replace(pmxdr.originRegex,"$1");function onloadHandler(){if(typeof instance.onload=="function")instance.onload()}if(instance.iFrame.addEventListener)instance.iFrame.addEventListener("load",onloadHandler,false);else if(instance.iFrame.attachEvent)instance.iFrame.attachEvent("onload",onloadHandler);instance.iFrame.src=instance.origin+pmxdr.getEndpoint(host);if(typeof onload=="function"){instance.onload=onload;instance.init()}}pmxdr.endpoints=[];pmxdr.originRegex=/^([\w-]+:\/*\[?[\w\.:-]+\]?(?::\d+)?).*/;pmxdr.request=function(req){if(typeof req=="string")return pmxdr.request({uri:req});else if(Object.prototype.toString.call(req)=="[object Array]"){var requests=[];for(var i=0;i<req.length;i++)requests.push(pmxdr.request(req[i]));return requests}var pmxdrInstance=new pmxdr(req.uri),callback=req.callback;req.id=pmxdr.getSafeID();req.callback=function(response){if(typeof callback=="function")callback.call(this,response);this.unload()};pmxdrInstance.onload=function(){this.request(req)};pmxdrInstance.init();return{abort:function(){pmxdr.requests.aborted[req.id]=true}}};pmxdr.interfaceFrameParent=document.documentElement||document.getElementsByTagName("head")[0]||document.body||document.getElementsByTagName("body")[0];pmxdr.getSafeID=function(){var randID=Math.random().toString().substr(2);if(typeof pmxdr.requests[randID]=="undefined")return randID;else return pmxdr.getSafeID()};pmxdr.getEndpoint=function(uri){var x,endpoint,endpoints=pmxdr.endpoints,length=endpoints.length;for(x=0;x<length;x++){endpoint=endpoints[x];if(typeof endpoint.origin==="string"){if(!uri.indexOf(endpoint.origin)){break}}else if(endpoint.origin.test(uri)){break}}return endpoint?endpoint.endpoint:"/pmxdr/api"};pmxdr.prototype={init:function(onload){if(typeof onload=="function")this.onload=onload;if(this.iFrame.parentNode)this.unload();pmxdr.interfaceFrameParent.appendChild(this.iFrame)},unload:function(){pmxdr.interfaceFrameParent.removeChild(this.iFrame)},defaultRequestMethod:"GET",request:function(req){var requests=[],instance=this;if(Object.prototype.toString.call(req)=="[object Array]"){for(var i=0;i<req.length;i++)requests.push(instance.request(req[i]));return requests}var id=(pmxdr.requests[req.id]?false:req.id)||pmxdr.getSafeID(),method=req.method||instance.defaultRequestMethod,timeout=req.timeout||instance.defaultTimeout,contentType=req.contentType||instance.defaultContentType;method=method.toUpperCase();pmxdr.requests[id]={origin:instance.origin,remove:function(){delete pmxdr.requests[id]},callback:function(response){if(typeof req.callback=="function")req.callback.call(instance,response);pmxdr.requests[id].remove()}};function timeoutCallback(){if(pmxdr.requests[id]&&pmxdr.requests[id].callback)pmxdr.requests[id].callback({pmxdr:true,id:id,error:"TIMEOUT"})}if(contentType){if(!req.headers)req.headers={};req.headers["Content-Type"]=contentType.toString()}instance.iFrame.contentWindow.postMessage(JSON.stringify({pmxdr:true,method:method,uri:req.uri,data:req.data,headers:req.headers,id:id}),instance.origin);if(timeout)setTimeout(timeoutCallback,timeout);return{abort:pmxdr.requests[id].remove}}};pmxdr.requests={aborted:{},clear:function(){pmxdr.requests={aborted:{},clear:this.clear}}};function pmxdrResponseHandler(evt){try{var data=JSON.parse(evt.data)}catch(e){return}if(data.pmxdr==true){if(pmxdr.requests[data.id]&&pmxdr.requests[data.id].origin==evt.origin&&typeof pmxdr.requests[data.id].callback=="function"&&!pmxdr.requests.aborted[data.id])pmxdr.requests[data.id].callback(data);else if(pmxdr.requests.aborted[data.id]){delete pmxdr.requests.aborted[data.id];if(data.id in pmxdr.requests)delete pmxdr.requests[data.id]}}}if(window.addEventListener)window.addEventListener("message",pmxdrResponseHandler,false);else if(window.attachEvent)window.attachEvent("onmessage",pmxdrResponseHandler);pmxdr.destruct=function(){if(window.removeEventListener)window.removeEventListener("message",pmxdrResponseHandler,false);else if(window.detachEvent)window.detachEvent("onmessage",pmxdrResponseHandler);delete window.pmxdr;delete pmxdrResponseHandler};window.pmxdr=pmxdr})(window)},{}],4:[function(require,module,exports){(function(undef){"use strict";var alwaysTrustedOrigins=[/^https?:\/\/[\w\-]+\.ft\.com$/i];function cleanHeader(dirty){if(typeof dirty!=="string"){return""}var clean;clean=dirty.replace(/[ \n\r\t]/g,"").toUpperCase();return clean}function getAllHeaders(request){var headers,header,i,responseHeaders;headers={};responseHeaders=request.getAllResponseHeaders().split(/\r?\n/);for(i=0;i<responseHeaders.length;i+=1){header=responseHeaders[i].split(": ");headers[header[0].toLowerCase()]=header[1]}return headers}function getHeader(request,name){try{return request.getResponseHeader(name)}catch(e){return""}}function getCorsHeaders(request){return{origin:getHeader(request,"Access-Control-Allow-Origin"),methods:getHeader(request,"Access-Control-Allow-Methods")}}function isAllowedMethod(method,headerValue){headerValue=cleanHeader(headerValue);if(!headerValue||headerValue==="*"){return true}headerValue=","+headerValue+",";if(headerValue.indexOf(","+method+",")!==-1){return true}return false}function isAlwaysTrusted(origin){var i,isTrusted;for(i=0;i<alwaysTrustedOrigins.length;i+=1){if(alwaysTrustedOrigins[i]instanceof RegExp){isTrusted=alwaysTrustedOrigins[i].test(origin)}else if(typeof alwaysTrustedOrigins[i]==="string"){isTrusted=origin===alwaysTrustedOrigins[i]}if(isTrusted){return true}}return false}function isTrustedOrigin(origin,headerValue){origin=origin.toUpperCase();if(isAlwaysTrusted(origin)){return true}headerValue=cleanHeader(headerValue);if(headerValue==="*"||headerValue===origin){return true}return false}function makeRequest(method,uri,headers,data,callback){var header,request;request=new XMLHttpRequest;request.open(method,uri,true);if(headers){for(header in headers){if(headers.hasOwnProperty(header)){request.setRequestHeader(header,headers[header])}}}if(typeof data==="string"){request.send(data)}else{request.send(null)}if(callback){request.onreadystatechange=function(){if(request.readyState!==4){return}callback(request)}}return request}if(window.opera!==undef){if(parseInt(window.opera.version(),10)===9){Event.prototype.__defineGetter__("origin",function(){return"http://"+this.domain})}}function pmxdrRequestHandler(evt){var data,optionsCorsHeaders,origin,source,reply;function sendReply(response){source.postMessage(JSON.stringify(response),origin)}function replyError(code){reply.error=code;sendReply(reply)}function handleResponse(request){var corsHeaders;if(request.readyState!==4){return}reply.status=request.status;reply.statusText=request.statusText;if(!request.status){replyError("LOAD_ERROR");return}if(request.status===1223){reply.status=204;reply.statusText="No Content";corsHeaders=optionsCorsHeaders}else{corsHeaders=getCorsHeaders(request)}if(!isTrustedOrigin(origin,corsHeaders.origin)){replyError("DISALLOWED_ORIGIN");return}if(!isAllowedMethod(data.method,corsHeaders.methods)){replyError("DISALLOWED_REQUEST_METHOD");return}reply.data=request.responseText;reply.headers=getAllHeaders(request);sendReply(reply)}source=evt.source;origin=evt.origin;try{data=JSON.parse(evt.data)}catch(e){return}if(typeof data!=="object"||data.pmxdr!==true){return}reply={pmxdr:true};if(data.id!==undef){reply.id=data.id}if(typeof data.method==="string"){data.method=data.method.toUpperCase()}makeRequest("OPTIONS",data.uri,data.headers,null,function(optionsRequest){optionsCorsHeaders=getCorsHeaders(optionsRequest);if(data.method==="OPTIONS"){handleResponse(optionsRequest);return}makeRequest(data.method,data.uri,data.headers,data.data,handleResponse)})}if(window.addEventListener){window.addEventListener("message",pmxdrRequestHandler,false)}else if(window.attachEvent){window.attachEvent("onmessage",pmxdrRequestHandler)}window.pmxdrRequestHandler=pmxdrRequestHandler})()},{}]},{},[2]);